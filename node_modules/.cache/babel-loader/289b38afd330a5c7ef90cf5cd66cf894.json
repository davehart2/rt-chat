{"ast":null,"code":"import _regeneratorRuntime from\"/home/david/repos/rt-chat/rt-chat/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/david/repos/rt-chat/rt-chat/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/david/repos/rt-chat/rt-chat/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState,useEffect}from\"react\";import{useHistory}from\"react-router-dom\";import{ChatEngine}from\"react-chat-engine\";import{auth}from\"../firebase\";import{useAuth}from\"../contexts/AuthContext\";import axios from\"axios\";var Chats=function Chats(){var history=useHistory();var _useAuth=useAuth(),user=_useAuth.user;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var handleLogout=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return auth.signOut();case 2:history.push(\"./\");case 3:case\"end\":return _context.stop();}}},_callee);}));return function handleLogout(){return _ref.apply(this,arguments);};}();var getFile=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(url){var response,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetch(url);case 2:response=_context2.sent;_context2.next=5;return response.blob();case 5:data=_context2.sent;return _context2.abrupt(\"return\",new File([data],\"userPhoto.jpg\",{type:\"image/jpeg\"}));case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function getFile(_x){return _ref2.apply(this,arguments);};}();useEffect(function(){if(!user){history.push(\"./\");return;}axios.get(\"https://api.chatengine.io/users/me\",{headers:{\"project-id\":process.env.RT_CHAT_APP_ID,\"user-name\":user.email,\"user-secret\":user.uid}}).then(function(){setLoading(false);}).catch(function(){var formdata=new FormData();formdata.append(\"email\",user.email);formdata.append(\"username\",user.email);formdata.append(\"secret\",user.uid);getFile(user.photoURL).then(function(avatar){formdata.append(\"avatar\",avatar,avatar.name);axios.post(\"https://api.chatengine.io/users\",formdata,{headers:{\"private-key\":process.env.RT_CHAT_APP_KEY}}).then(function(){return setLoading(false);}).catch(function(error){return console.log(error);});});});},[user,history]);return/*#__PURE__*/React.createElement(\"div\",{className:\"chats-page\"},/*#__PURE__*/React.createElement(\"div\",{className:\"nav-bar\"},/*#__PURE__*/React.createElement(\"div\",{className:\"logo-tab\"},\"Welcome\"),/*#__PURE__*/React.createElement(\"div\",{className:\"logout-tab\",onClick:handleLogout},\"Logout\")),/*#__PURE__*/React.createElement(ChatEngine,{height:\"calc(100vh - 66px\",projectID:process.env.RT_CHAT_APP_ID,userName:user.email,userSecret:user.uid}));};export default Chats;","map":{"version":3,"sources":["/home/david/repos/rt-chat/rt-chat/src/components/Chats.js"],"names":["React","useRef","useState","useEffect","useHistory","ChatEngine","auth","useAuth","axios","Chats","history","user","loading","setLoading","handleLogout","signOut","push","getFile","url","fetch","response","blob","data","File","type","get","headers","process","env","RT_CHAT_APP_ID","email","uid","then","catch","formdata","FormData","append","photoURL","avatar","name","post","RT_CHAT_APP_KEY","error","console","log"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { ChatEngine } from \"react-chat-engine\";\nimport { auth } from \"../firebase\";\nimport { useAuth } from \"../contexts/AuthContext\";\nimport axios from \"axios\";\n\nconst Chats = () => {\n  const history = useHistory();\n  const { user } = useAuth();\n  const [loading, setLoading] = useState(true);\n\n  const handleLogout = async () => {\n    await auth.signOut();\n    history.push(\"./\");\n  };\n\n  const getFile = async (url) => {\n    const response = await fetch(url);\n    const data = await response.blob();\n\n    return new File([data], \"userPhoto.jpg\", { type: \"image/jpeg\" });\n  };\n\n  useEffect(() => {\n    if (!user) {\n      history.push(\"./\");\n      return;\n    }\n    axios\n      .get(\"https://api.chatengine.io/users/me\", {\n        headers: {\n          \"project-id\": process.env.RT_CHAT_APP_ID,\n          \"user-name\": user.email,\n          \"user-secret\": user.uid,\n        },\n      })\n      .then(() => {\n        setLoading(false);\n      })\n      .catch(() => {\n        let formdata = new FormData();\n        formdata.append(\"email\", user.email);\n        formdata.append(\"username\", user.email);\n        formdata.append(\"secret\", user.uid);\n\n        getFile(user.photoURL).then((avatar) => {\n          formdata.append(\"avatar\", avatar, avatar.name);\n          axios\n            .post(\"https://api.chatengine.io/users\", formdata, {\n              headers: {\n                \"private-key\": process.env.RT_CHAT_APP_KEY,\n              },\n            })\n            .then(() => setLoading(false))\n            .catch((error) => console.log(error));\n        });\n      });\n  }, [user, history]);\n\n  return (\n    <div className=\"chats-page\">\n      <div className=\"nav-bar\">\n        <div className=\"logo-tab\">Welcome</div>\n        <div className=\"logout-tab\" onClick={handleLogout}>\n          Logout\n        </div>\n      </div>\n      <ChatEngine\n        height=\"calc(100vh - 66px\"\n        projectID={process.env.RT_CHAT_APP_ID}\n        userName={user.email}\n        userSecret={user.uid}\n      />\n    </div>\n  );\n};\n\nexport default Chats;\n"]},"metadata":{},"sourceType":"module"}